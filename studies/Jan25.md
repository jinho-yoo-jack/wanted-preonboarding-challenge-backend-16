# 1월 25일 구현사항

- 이벤트를 이용해 예약 기능을 구현하였다.
  1. `공연` 객체를 불러온다(없다면 예외처리한다).
  2. `예약` 객체를 초기화한다.
  3. `좌석정보` 객체를 초기화한다.
  4. 해당 공연의 좌석이 이미 예약되었다면 예외처리한다. 
  5. `예약` 이벤트를 발생시킨다.
     1. `공연 좌석` 객체를 불러온다(없다면 예외처리한다). 
     2. `공연 좌석`이 `예약 불가능`이면 예외처리한다. 
     3. `공연 좌석`의 `상태를 변환`시킨다. 
     4. 공연id를 이용해 예약 가능 좌석을 조회해 없다면 `만석` 이벤트를 발생시킨다. 
        1. `공연`을 불러온다. 
        2. `공연`의 `예약 가능 여부`를 `불가능`으로 만든다.
  6. `공연`객체를 저장한다.
  7. Response객체를 반환한다.
- ![스크린샷 2024-01-25 11 40 09](https://github.com/jinho-yoo-jack/wanted-preonboarding-challenge-backend-16/assets/99702271/b47fe8b6-7a6c-4650-8141-921c8b16e51b)
  - `JOIN`을 사용해야한다는 코멘트가 있었다. 
  - 기존 로직의 연관관계를 전부 집어넣자!(드디어!)

- UserInfo를 가지고 `공연`과 `예약`을 조회해서 ReservationResponse를 초기화해야한다. 
  - Raw Query를 이용하는 것도 방법일 것이다. 
  - 근데, 최근 네이버 부스트캠프를 하면서 Java를 잘 안쓰고, NestJS나 실제 쿼리를 쓰는 일이 잦았다. 
  - 그렇다면, 이참에 QueryDSL을 써보는 것은 어떨까?
  - QueryDSL을 이용하면 바로 ReservationResponse객체의 배열로 반환할 수 있다. 
- 예약 취소 기능을 구현했다. 
  - `특정 공연에 대해서 취소 건이 발생하는 경우, 알림 신청을 해놓은 고객에게 취소된 예약이 있다는 사실을 알리는 알림 서비스`라는 요구사항이 있었다. 
  - 알림 서비스의 전제는 취소 건 발생시이다. 
  - 그래서 취소 기능부터 구현해야겠다는 생각이 들었다.

# 뒤늦은 생각

- 알림 등록 기능을 구현해야 한다.
  - 알림 등록 api가 있어, 해당 api를 통해서 공연ID, 이름, 전화번호를 저장하고 처리해야겠다는 생각이 들었다. 
  - 이를 위해서 POST api로 처리를 하는게 낫겠다는 생각이 들었다. 
  - 이후에, 취소 이벤트에 알림 로직을 추가해야겠다는 생각이 든다.