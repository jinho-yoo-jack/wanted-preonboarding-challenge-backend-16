# 1월 23일 학습 내용

## 도메인 주도 설계

## 주요 용어 분석

1. 도메인 이벤트 : 발생한 사건
2. 커맨드 : 도메인 이벤트를 발생시키는 명령어
3. 외부 시스템 : 도메인 이벤트가 호출하거나 관계가 있는 레거시 또는 외부 시스템
4. 액터 : 개인 또는 조직의 역할
5. 핫스팟 : 의문사항, 결정하기 힘든 사항
6. 애그리게이트 : 도메인 이벤트와 커맨드가 처리하는 데이터, 상태가 변경되는 데이터
7. 정책 : 이벤트 조건에 따라 진행되는 결정, "이벤트"가 발생할 때, "커맨드"를 실행한다.
8. 정보 : 액터에게 제공되는 데이터, 결정을 내리는데 영향을 주는 정보

## 용어를 가지고 비즈니스 요구사항 분석하기

### 비즈니스 요구사항을 무엇으로 보아야 할까?
- 커맨드로 보고 이번 과제를 진행해보려고 한다. 
  - 각 요구사항을 보았을 때, 아래와 같이 보게 되었다. 
    - 예약 시스템 : `POST /reserve`
    - 예약 조회 시스템 : `GET /query/all/performance`
    - 예약 조회 시스템 : `GET /reserve (queryParam으로 name, phoneNumber)`
    - 예약 가능 알림 서비스 : 옵저버를 이용한 알림 기능
  - 여기에서 알림을 제외한 요구사항들은 api라는 명령어가 존재한다. 
  - 알림 기능 또한 옵저버를 이용했을 때, `예약 취소`라는 명령으로 동작을 하게 할 수 있다고 생각했다. 

### 우리에게 필요한 외부 시스템은 무엇일까?
- 알림 기능
  - 공연이 취소될 때 이를 알림처리 해주어야 한다. 
  - 어떻게 외부 시스템을 사용할까?
    - 전화번호를 이용한 SMS 서비스를 만들어보자. 
    - Twilio를 이용한 SMS 전송 로직을 만든다. 
      - `Send Message: 공연ID, 공연명, 회차, 시작 일시 예매 가능한 좌석 정보`의 기능을 구현할 수 있다. 

### 도메인 이벤트들 생각해보기
![스크린샷 2024-01-23 15 54 32](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/848e7096-8c00-408c-a5f2-fc5364f04e80)
- 1차적으로 생각한 도메인 이벤트들이다.

### 외부 이벤트 생각해보기
![스크린샷 2024-01-23 15 54 50](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/b6d8c010-53ac-4c6f-8753-0eb9467e0060)
- 도입할 가능성이 있는 외부 이벤트들도 생각해보았다. 
- 결제 시스템의 경우, 후에 실제 결제 기능을 만들 수 있기 때문에 여지만 남겨두었다. 
- 알림 문자 발송은 Twilio를 이용한 SMS 요청 기능을 활용할 계획이다. 

### 커맨드 작성하기
- 위에서 비즈니스 요구사항을 커맨드라고 했지만, 커맨드를 추가로 작성하는 이유는, 비즈니스 요구사항을 충족하기 위해서 선행되어야 할 커맨드들이 있을 수 있다고 판단했기 때문이다.
![스크린샷 2024-01-23 15 55 16](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/57fbb6ed-c703-46cc-9f2e-f4e26963beb7)
- 실제로 예약 가능 공연 전체 조회/예약 가능 공연의 좌석 조회 api가 분리되었다. 
- 예약 취소시 예약 가능 알림 기능은 예약 취소 api의 호출시에 성공했을 때 알림처리가 되도록 만들었다. 

### 핫스팟 생각해보기
![스크린샷 2024-01-23 15 55 45](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/8502ce68-aa47-46b5-97a0-7ba8f4b9159a)

- README.md에 할인이 적용될 수 있다고 했지만, 그 방식이 모호했다. 
- 할인율이 공연의 분류에 따른 할인인지, 공연의 UUID를 이용한 할인율 저장인지 확실치가 않았다. 
- init.db를 보았을 때, 공연마다 할인율을 적용하는 것으로 인식해, UUID에 할인율을 저장하는 방식으로 객체를 생성하기로 했다.
- 또한, 예약 가능 여부확인과 좌석 처리에 대해 고민했었고, 이에 대한 해결방안을 같이 올려두었다.

### 액터 배치하기(안한 이유)

- 액터란 커맨드에서 사용자의 역할을 말한다. 
- 일반적인 쇼핑몰이라고 생각하고 이를 대입해보면 모든 경우에 총 5가지 경우가 있다. 
  - admin
  - 비회원 구매자
  - 회원 구매자
  - 비회원 판매자
  - 회원 판매자
- 하지만 우리의 요구사항에서는 비회원 구매자가 모든 이벤트를 발생시킬 수 있다. 
- 액터는 배치하지 않기로 했다. 

### 애그리게이트 정의
![스크린샷 2024-01-23 15 13 30](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/ea003c42-6c3d-4cb9-a5f9-e5df40445345)


- 회원, 공연, 좌석이라는 애그리게이트 루트를 두어서 정의를 해보았다. 
- 하지만, 해당 애그리게이트를 전체로 보기에는, 너무 방대하다는 생각이 들었다. 

### 애그리게이트 루트에서 밸류 객체 분리해보기
![스크린샷 2024-01-23 15 24 23](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/4a444bb3-ce51-498f-95d7-a35d053f6383)

- 이러한 방식으로 애그리게이트를 원시값을 포장할 때 까지 분류해보았다. 
- 회원의 경우, 요청시에 회원 정보와 잔고로 묶어 회원 정보만으로도 요청이 오갈 수 있기 때문에 다시 캡슐화시켰다. 

### 다시 밸류 객체를 올려보기
![스크린샷 2024-01-23 15 26 46](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/53606d18-0d83-42a1-9a38-b7f766371662)


- 이런식으로 객체를 올릴 수 있게 되었다. 

### 바운디드 컨텍스트 정의하기 및 정책 도출
![스크린샷 2024-01-23 15 38 27](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/860ceeb0-9181-48b5-ae6b-b6035f558de0)


- 애그리게이트를 기준으로 새롭게 칸을 정리해보려고 한다. 

![스크린샷 2024-01-23 15 47 38](https://github.com/JangAJang/wanted-preonboarding-challenge-backend-16/assets/99702271/1ca9cbd4-a0d4-4b9f-a76a-f1bb624cb6aa)


- 회원, 공연, 좌석이라는 바운디드 컨텍스트가 있고, 해당 컨텍스트에 따른 정책들을 등록했다. 

